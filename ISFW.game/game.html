<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="./jquery.min.js"></script>
    <script type="text/javascript" src="./osql.js"></script>

    <script>
        $().ready(function () {
            //check();
            x = 0;
            setInterval(doCount, 2000);
            waiting();
        });

        async function doCount() {
            x++;
            //check();
        }

        async function waiting() {
            var me = await osql.getMe();
            var gameId = osql.getParam("gameid");
            var sql =  `select * from Games where room_id = ${gameId};`;
            var objects = await osql.connect(sql);
            var turn = Number(objects[0].turn);
            var player_num = Number(objects[0].player_num);
            console.log(me.id)
            sql =  `select * from GroupPlayers where PlayerId = "${me.id}";`; 
            objects = await osql.connect(sql);
            var player_order = Number(objects[0].item_order);
            var amari = turn % player_num;
            if(amari == player_order){
                document.getElementById("comment").innerHTML = "あなたの番です"
            }else{
                document.getElementById("comment").innerHTML = "待っててね"
            }
        }


        // function Answer() {
        //     document.getElementById('comment').innerHTML =  'さんの番です。' //+ <input type = "text" id = "word"><button onclick="buttonPressed()">送信</button>;
        // }

        async function check(){
            var word = document.getElementById('tf2').value;
            var sql_1 = `select * from Tweets ;`
            var objects = await osql.connect(sql_1);
            var html = '';
            html = html + '<table border="1">';
            for (var i = 0; i < objects.length; i++) {
                var object = objects[i];
                html = html + '<tr>';
                html = html + '<td>' + object.id + '</td>';
                html = html + '<td>' + object.name + '</td>';
                html = html + '<td>' + object.tweet + '</td>';
                html = html + '<td>' + object.time + '</td>';
                html = html + '</tr>';
            }
            html = html + '</table>';
            document.getElementById('result').innerHTML = html;
        }
    </script>

</head>

<body>
    <h1>game.html</h1>
    <p id = 'comment'></p>

</body>

</html>